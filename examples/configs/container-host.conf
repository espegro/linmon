# ============================================================================
# LinMon Container Host Configuration
# ============================================================================
# Optimized for: Docker hosts, Kubernetes nodes, container orchestration platforms
# Focus: Container security, escape detection, namespace manipulation monitoring
# Expected volume: 500-2000 events/day
#
# This configuration emphasizes container-specific security monitoring while
# managing the high event volume from containerized workloads. Tracks container
# metadata and focuses on detecting container escapes and malicious containers.

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

log_file = /var/log/linmon/events.json
log_to_syslog = false
log_rotate = true
log_rotate_size = 200M        # Larger logs due to container activity
log_rotate_count = 15
verbosity = 1

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================

monitor_processes = true
monitor_process_exit = false  # Too noisy with container starts/stops
monitor_files = false         # Container I/O creates massive volume
monitor_tcp = true            # Monitor container network activity
monitor_udp = false           # DNS queries from containers create noise
monitor_vsock = true          # IMPORTANT: Detect VM-to-host communication

# ============================================================================
# FILTERING CONFIGURATION
# ============================================================================

# Monitor all users (containers may run as different UIDs)
min_uid = 0
max_uid = 0

# Don't require TTY (containers typically don't have TTY)
require_tty = false

# Filter threads to reduce noise
ignore_threads = true

# Optional: Filter container runtime noise
# Uncomment and adjust based on your container runtime
# ignore_processes = containerd,dockerd,runc,conmon,pause

# ============================================================================
# NETWORK FILTERING
# ============================================================================

# Minimal network filtering - containers communicate on private networks
# Only filter localhost, keep inter-container traffic visible
# Adjust based on infrastructure (pod networks, service meshes)
ignore_networks = 127.0.0.0/8

# For Kubernetes: Consider filtering pod CIDR ranges to reduce noise
# Example: ignore_networks = 127.0.0.0/8,10.244.0.0/16

# ============================================================================
# ENRICHMENT & PRIVACY
# ============================================================================

capture_cmdline = true
redact_sensitive = true
resolve_usernames = true
hash_binaries = true          # Critical for detecting malicious container images
verify_packages = true        # Detect unpackaged binaries in containers
capture_container_metadata = true  # CRITICAL: Enable container awareness

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================

cache_save_interval = 5

# ============================================================================
# TAMPER DETECTION
# ============================================================================

checkpoint_interval = 30

# ============================================================================
# SECURITY MONITORING - CONTAINER-FOCUSED
# ============================================================================

# Core security detections
monitor_cred_read = true      # Credential theft from host or containers
monitor_cred_write = true     # Account manipulation
monitor_ldpreload = true      # LD_PRELOAD rootkit
monitor_modules = true        # Kernel module loading (container escape technique)
monitor_memfd = true          # Fileless malware in containers
monitor_execveat = true       # Fileless execution
monitor_bpf = true            # eBPF rootkits
monitor_log_tamper = true     # Log clearing

# Container-specific detections (IMPORTANT)
monitor_ptrace = false        # Container debugging is common
monitor_bind = false          # Containers bind ports legitimately
monitor_unshare = true        # CRITICAL: Detect namespace manipulation (container escape)
monitor_persistence = false   # Container lifecycle creates noise
monitor_suid = false          # Container images may have SUID binaries

# ============================================================================
# NOTES
# ============================================================================
# Expected event volume: 500-2000 events/day
# - Process exec: 300-1000/day (container starts, init processes)
# - Network TCP: 200-800/day (inter-container communication)
# - Security: 5-50/day (investigate namespace events)
#
# Performance impact: 2-5% CPU typical (higher due to container activity)
# Disk usage: ~50-200MB/day logs
#
# Container Escape Detection:
# - Monitor security_unshare events (namespace manipulation)
# - Monitor security_module events (kernel module loading)
# - Track processes that transition from container to host namespaces
# - Alert on container processes accessing host filesystem paths
#
# SIEM Integration Recommendations:
# - Parse container.runtime and container.id fields
# - Group events by container.id for per-container analysis
# - Alert on container.runtime=unknown (unrecognized container type)
# - Alert on processes with container namespace that access host paths
# - Correlate container.ns_pid changes (namespace escape indicator)
# - Alert on security_unshare events from within containers
# - Track container.pod_id for Kubernetes pod-level correlation
# - Alert on package=null in container contexts (malicious images)
# - Baseline normal container behavior per image hash
#
# Kubernetes-Specific:
# - Use container.pod_id for pod-level aggregation
# - Alert on suspicious activity across pods in same deployment
# - Monitor kube-proxy, kubelet processes for compromise
# - Track container image hashes (sha256 field) against known good images
#
# Docker-Specific:
# - Monitor dockerd and containerd for suspicious commands
# - Alert on privileged container launches (visible in container metadata)
# - Track docker exec commands into running containers
#
# Container Image Security:
# - Build baseline of known good image hashes
# - Alert on process_exec with sha256 not in baseline
# - Alert on package=null in containers (unpackaged binaries)
# - Monitor for crypto miners (high CPU, external network connections)
#
# Tuning for High Volume Environments:
# - Add container runtime processes to ignore_processes
# - Filter pod network CIDR ranges in ignore_networks
# - Increase log_rotate_size and log_rotate_count
# - Consider sampling: only log security events + percentage of normal events
# - Use SIEM-side filtering to focus on specific container images
#
# Recommended for:
# - Docker hosts running multiple containers
# - Kubernetes worker nodes
# - Container orchestration platforms (OpenShift, Rancher)
# - Microservices infrastructure
# - CI/CD build servers running containers
#
# NOT recommended for:
# - Desktop systems (use desktop.conf)
# - Traditional servers without containers (use server.conf)
# - SSH bastion hosts (use bastion.conf)
