# ============================================================================
# LinMon Bastion/Login Server Configuration
# ============================================================================
# Optimized for: SSH bastion hosts, jump servers, multi-user login systems
# Focus: High security, credential theft detection, lateral movement prevention
# Expected volume: 200-1000 events/day
#
# This configuration monitors ALL users with comprehensive security detections.
# Optimized for SSH-based access where users authenticate and run commands.
# Emphasizes credential protection and unauthorized access detection.

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

log_file = /var/log/linmon/events.json
log_to_syslog = false  # Use remote syslog forwarding for tamper resistance
log_rotate = true
log_rotate_size = 100M
log_rotate_count = 30  # Keep 30 days for compliance/forensics
verbosity = 1

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================

monitor_processes = true
monitor_process_exit = false  # Focus on exec events
monitor_files = false         # Too noisy for login servers
monitor_tcp = true            # CRITICAL: Detect lateral movement
monitor_udp = false           # Usually not relevant
monitor_vsock = false         # Not applicable to bastion hosts

# ============================================================================
# FILTERING CONFIGURATION
# ============================================================================

# Monitor ALL users including root (critical for compromise detection)
min_uid = 0
max_uid = 0

# Optional: Only log TTY sessions (SSH, console)
# Disable this if you need to monitor cron jobs and background tasks
require_tty = false

# Keep threads visible (minimal noise on bastion hosts)
ignore_threads = false

# No process filtering - log everything
ignore_processes =
only_processes =

# ============================================================================
# NETWORK FILTERING
# ============================================================================

# Only filter localhost - log ALL other connections (critical for lateral movement)
# Do NOT filter private networks on bastion hosts
ignore_networks = 127.0.0.0/8

# ============================================================================
# ENRICHMENT & PRIVACY
# ============================================================================

capture_cmdline = true
redact_sensitive = true       # CRITICAL: Protect passwords in logs
resolve_usernames = true
hash_binaries = true          # CRITICAL: IOC matching, threat hunting
verify_packages = true        # CRITICAL: Detect unpackaged/modified binaries
capture_container_metadata = false  # Bastion hosts typically don't run containers

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================

cache_save_interval = 5

# ============================================================================
# TAMPER DETECTION
# ============================================================================

checkpoint_interval = 15      # Frequent checkpoints for tamper detection

# ============================================================================
# SECURITY MONITORING - COMPREHENSIVE (HIGH SECURITY)
# ============================================================================

# ALL core security detections enabled
monitor_cred_read = true      # CRITICAL: Credential theft (shadow, sudoers, SSH keys)
monitor_cred_write = true     # CRITICAL: Account manipulation, SSH backdoors
monitor_ldpreload = true      # CRITICAL: Rootkit detection
monitor_modules = true        # CRITICAL: Kernel rootkits
monitor_memfd = true          # Fileless malware
monitor_execveat = true       # Fileless execution
monitor_bpf = true            # eBPF rootkits
monitor_log_tamper = true     # CRITICAL: Anti-forensics detection

# Higher noise detections (acceptable on bastion hosts)
monitor_ptrace = true         # Process injection (gdb rarely used on bastion)
monitor_bind = false          # Services may bind ports legitimately
monitor_unshare = false       # Rare on bastion hosts
monitor_persistence = true    # CRITICAL: Detect persistence mechanisms
monitor_suid = true           # CRITICAL: Privilege escalation attempts

# ============================================================================
# NOTES
# ============================================================================
# Expected event volume: 200-1000 events/day
# - Process exec: 100-500/day (user commands)
# - Network TCP: 50-300/day (lateral movement, external connections)
# - Security: 0-20/day (INVESTIGATE ALL - should be rare)
#
# Performance impact: 1-3% CPU typical
# Disk usage: ~20-100MB/day logs
#
# SIEM Integration Recommendations:
# - Alert on package=null (unpackaged binaries)
# - Alert on pkg_modified=true (modified system binaries)
# - Alert on ANY security_cred_read events (except from ssh, sudo)
# - Alert on security_persistence events
# - Alert on monitor_suid events (privilege escalation setup)
# - Alert on TCP connections TO other internal hosts (lateral movement)
# - Correlate process_exec with net_connect_tcp for C2 detection
#
# Hardening Recommendations:
# - Forward logs to remote syslog server (tamper resistance)
# - Set log_to_syslog = true and configure rsyslog forwarding
# - Enable auditd for kernel-level logging (defense in depth)
# - Restrict package=null binaries with AppArmor/SELinux
# - Monitor LinMon daemon_start checkpoints in SIEM
#
# Recommended for:
# - SSH bastion hosts
# - Jump servers
# - Multi-user development servers
# - Privileged access workstations (PAW)
# - Systems with elevated security requirements
#
# NOT recommended for:
# - Desktop systems (too noisy, use desktop.conf)
# - High-volume application servers (use server.conf)
# - Container orchestration hosts (use container-host.conf)
