# ============================================================================
# LinMon Application Server Configuration
# ============================================================================
# Optimized for: Web servers, API servers, database servers, application hosts
# Focus: Security monitoring with acceptable performance overhead
# Expected volume: 200-500 events/day
#
# This configuration balances security visibility with low noise. Monitors
# all users but filters high-volume application activity. Focuses on detecting
# compromise indicators while minimizing impact on production workloads.

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

log_file = /var/log/linmon/events.json
log_to_syslog = false
log_rotate = true
log_rotate_size = 100M
log_rotate_count = 10
verbosity = 1

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================

monitor_processes = true
monitor_process_exit = false  # Reduce noise from short-lived processes
monitor_files = false         # Application file I/O creates too much noise
monitor_tcp = true            # Network monitoring for lateral movement
monitor_udp = false           # DNS/NTP not typically interesting
monitor_vsock = false         # Not applicable unless VM host

# ============================================================================
# FILTERING CONFIGURATION
# ============================================================================

# Monitor all users including root (detect privilege escalation)
min_uid = 0
max_uid = 0

# Log both interactive and non-interactive sessions
require_tty = false

# Filter threads to reduce noise from multi-threaded applications
ignore_threads = true

# Optional: Filter noisy application processes
# Example for web servers: ignore_processes = nginx,apache2,php-fpm
# Example for databases: ignore_processes = mysqld,postgres,redis-server
ignore_processes =

# ============================================================================
# NETWORK FILTERING
# ============================================================================

# Filter private networks to focus on external connections
# Adjust based on infrastructure (keep internal monitoring if needed)
ignore_networks = 127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# ============================================================================
# ENRICHMENT & PRIVACY
# ============================================================================

capture_cmdline = true
redact_sensitive = true
resolve_usernames = true
hash_binaries = true          # Critical for threat hunting
verify_packages = true        # Detect unauthorized binaries
capture_container_metadata = true  # May run containerized services

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================

cache_save_interval = 5

# ============================================================================
# TAMPER DETECTION
# ============================================================================

checkpoint_interval = 30      # Regular integrity checkpoints

# Authentication file integrity (recommended for servers)
monitor_auth_integrity = true   # Verify sshd, sudo, PAM configs
auth_integrity_interval = 30    # Match checkpoint frequency

# ============================================================================
# SECURITY MONITORING - BALANCED (LOW NOISE, HIGH VALUE)
# ============================================================================

# Core security detections (very low false positive rate)
monitor_cred_read = true      # Credential theft detection
monitor_cred_write = true     # Account manipulation
monitor_ldpreload = true      # LD_PRELOAD rootkit
monitor_modules = true        # Kernel module loading
monitor_memfd = true          # Fileless malware
monitor_execveat = true       # Fileless execution
monitor_bpf = true            # eBPF rootkits
monitor_log_tamper = true     # Log clearing/tampering

# Higher noise detections (disabled to reduce false positives)
monitor_ptrace = false        # Application monitoring tools may use ptrace
monitor_bind = false          # Applications bind to ports legitimately
monitor_unshare = false       # Rare unless using containers
monitor_persistence = false   # Legitimate cron jobs, systemd timers
monitor_suid = false          # Package updates may set SUID bits

# ============================================================================
# NOTES
# ============================================================================
# Expected event volume: 200-500 events/day
# - Process exec: 100-300/day (administrative tasks, cron jobs)
# - Network TCP: 50-200/day (external connections only)
# - Security: 0-10/day (should investigate)
#
# Performance impact: 0.5-2% CPU typical
# Disk usage: ~20-50MB/day logs
#
# SIEM Integration Recommendations:
# - Alert on package=null (unpackaged binaries)
# - Alert on security_cred_read from unexpected processes
# - Alert on security_log_tamper events
# - Alert on security_ldpreload, security_module events
# - Correlate process_exec with external net_connect_tcp (C2 beaconing)
# - Baseline normal application behavior, alert on deviations
#
# Tuning Guidelines:
# - If application creates many short-lived processes, add to ignore_processes
# - If application forks many threads, ensure ignore_threads = true
# - For database servers, consider filtering database process exec events
# - For compile servers, increase rate limits or use ignore_processes
# - Monitor for 1 week, analyze event volume, adjust filters as needed
#
# Performance Optimization:
# - Use ignore_processes for high-exec-rate applications
# - Keep monitor_files = false (generates massive volume)
# - Use ignore_networks to filter internal service communication
# - Enable monitor_process_exit only if needed for forensics
#
# Recommended for:
# - Web application servers (nginx, Apache, Node.js)
# - API servers (REST, GraphQL backends)
# - Database servers (MySQL, PostgreSQL, MongoDB)
# - Cache servers (Redis, Memcached)
# - Message queue servers (RabbitMQ, Kafka)
# - General-purpose application hosts
#
# NOT recommended for:
# - Desktop/laptop systems (use desktop.conf)
# - SSH bastion hosts (use bastion.conf for higher security)
# - Container orchestration platforms (use container-host.conf)
